<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>66-Character Line Formatter</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  
  <style>
    :root{
      --term-bg:#000000;
      --term-frame:#2b2b2b;
      --term-frame-hi:#6b6b6b;
      --term-cyan:#00ffff;
      --term-yellow:#ffff00;
      --term-green:#00ff00;
      --term-red:#ff3b3b;
      --term-white:#f2f2f2;
    }

    *{box-sizing:border-box;}
    html,body{ height: 100vh; margin: 0; overflow: hidden; }
    body{
      background:var(--term-bg);
      color:var(--term-cyan);
      font-family: Consolas, "Lucida Console", "Courier New", ui-monospace, monospace;
      display:flex;
      align-items:center;
      justify-content:center;
      padding: 10px;
    }

    /* Outer monitor frame */
    .frame{
      width:100%;
      height: 100%;
      max-width: 1020px;
      max-height: 98vh;
      background: var(--term-frame);
      border: 4px solid var(--term-frame-hi);
      box-shadow: 0 0 0 2px #101010, 0 10px 30px rgba(0,0,0,0.65);
      padding: 8px;
      display: flex;
      flex-direction: column;
    }

    /* Inner screen container */
    .container{
      flex: 1;
      display: flex;
      flex-direction: column;
      background: var(--term-bg);
      border: 2px solid #bfbfbf;
      overflow: hidden;
      position: relative;
    }

    /* Yellow Header Banner */
    .banner{
      background: var(--term-yellow);
      color: #000;
      font-weight: 700;
      text-align:center;
      padding: 6px 10px;
      border-bottom: 2px solid #000;
      letter-spacing: 0.4em;
      text-transform: uppercase;
      font-size: 14px;
      line-height: 1.1;
      flex-shrink: 0;
    }

    .subbanner{
      padding: 6px 12px;
      border-bottom: 1px solid rgba(0,255,255,0.3);
      display:flex;
      justify-content: space-between;
      align-items: center;
      flex-shrink: 0;
    }

    .subbanner .title{ font-size: 13px; font-weight: 700; color: var(--term-cyan); }
    .subbanner .hint{ font-size: 11px; color: var(--term-white); opacity: 0.7; }

    main{
      flex: 1;
      display: flex;
      flex-direction: column;
      padding: 10px;
      gap: 6px;
      overflow: hidden;
    }

    /* Input/Output Sections */
    .section-box {
      display: flex;
      flex-direction: column;
    }
    
    .input-section { height: 35%; min-height: 80px; }
    .output-section { flex: 1; min-height: 120px; }

    label{ display:block; font-weight: 700; margin-bottom: 2px; font-size: 12px; color: var(--term-cyan); }
    .muted{ color: var(--term-white); opacity: 0.8; font-size: 11px; }

    textarea, pre{
      width:100%;
      height: 100%;
      border: 1px solid rgba(0,255,255,0.4);
      background: var(--term-bg);
      color: var(--term-yellow);
      padding: 8px;
      font-size: 14px;
      line-height: 1.3;
      outline:none;
      resize: none;
      font-family: inherit;
    }

    textarea::placeholder { color: rgba(255,255,0,0.3); }

    pre{
      margin: 0;
      overflow-y: auto;
      white-space: pre-wrap;
      word-wrap: break-word;
      border-color: rgba(255,255,0,0.5);
    }

    /* Controls Layout */
    .control-row {
      display: flex;
      justify-content: flex-end;
      align-items: center;
      gap: 10px;
      padding: 2px 0;
      flex-shrink: 0;
    }

    .controls-group { display: flex; gap: 12px; align-items: center; }
    
    .btn{
      appearance:none;
      border: 1px solid rgba(0,255,255,0.7);
      background: #000;
      color: var(--term-yellow);
      padding: 6px 16px;
      font-size: 12px;
      font-weight: 700;
      cursor:pointer;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .btn.secondary{ color: var(--term-cyan); border-color: rgba(255,255,0,0.4); }
    .btn:hover{ background: var(--term-yellow); color: #000; }
    .btn:active{ transform: translateY(1px); }

    .statusbar{
      display:flex;
      gap: 15px;
      padding: 6px 12px;
      border-top: 1px solid rgba(0,255,255,0.3);
      font-size: 11px;
      background: #050505;
      flex-shrink: 0;
    }

    .stat strong{ color: var(--term-yellow); }
    .promptline{ padding: 6px 12px; color: var(--term-yellow); font-weight: 700; font-size: 11px; border-top: 1px solid rgba(255,255,0,0.2); flex-shrink: 0; }

    .spinner{
      display:inline-block;
      width: 10px; height: 10px;
      border: 2px solid rgba(0,255,255,0.2);
      border-top-color: var(--term-yellow);
      border-radius: 50%;
      animation: spin 0.7s linear infinite;
      margin-left: 6px;
    }
    .hidden{ display:none; }
    @keyframes spin{ to{ transform: rotate(360deg);} }

    ::-webkit-scrollbar { width: 8px; }
    ::-webkit-scrollbar-track { background: #000; }
    ::-webkit-scrollbar-thumb { background: #333; border: 1px solid #555; }
    ::-webkit-scrollbar-thumb:hover { background: #444; }
  </style>
</head>
<body>
  <div class="frame">
    <div class="container" role="application">
      <header>
        <div class="banner">EVENT INFORMATION</div>
        <div class="subbanner">
          <div class="title">66-Character Line Formatter</div>
          <div class="hint">Tabs â†’ 4 spaces | Newlines removed | 17-char word safety</div>
        </div>
      </header>

      <main>
        <section class="section-box input-section">
          <label for="inputText">Input Text <span class="muted">(Chars: <span id="inputLen">0</span>)</span></label>
          <textarea id="inputText" placeholder="Paste source text here..."></textarea>
        </section>

        <section class="control-row">
          <div class="controls-group">
            <button id="formatBtn" class="btn">Format <span id="formatSpinner" class="spinner hidden"></span></button>
            <button id="copyBtn" class="btn secondary">Copy Output</button>
          </div>
        </section>

        <section class="section-box output-section">
          <label for="output">Formatted Output (66-char width)</label>
          <pre id="output" tabindex="0"></pre>
        </section>
      </main>

      <div class="statusbar">
        <div class="stat">Lines: <strong><span id="outLines">0</span></strong></div>
        <div class="stat">Last Line Length: <strong><span id="lastLen">0</span></strong></div>
        <div id="statusMsg" class="stat">Status: Ready</div>
      </div>
      <div class="promptline">C:\PENPAL\FORMATTER> <span id="promptText">Ready.</span></div>
    </div>
  </div>

  <script>
    const inputEl = document.getElementById('inputText');
    const outputEl = document.getElementById('output');
    const formatBtn = document.getElementById('formatBtn');
    const formatSpinner = document.getElementById('formatSpinner');
    const copyBtn = document.getElementById('copyBtn');
    const inputLenEl = document.getElementById('inputLen');
    const outLinesEl = document.getElementById('outLines');
    const lastLenEl = document.getElementById('lastLen');
    const statusMsgEl = document.getElementById('statusMsg');
    const promptTextEl = document.getElementById('promptText');

    inputEl.addEventListener('input', () => {
        inputLenEl.textContent = inputEl.value.length;
    });

    function announceStatus(msg) {
      statusMsgEl.textContent = 'Status: ' + msg;
      promptTextEl.textContent = msg;
    }

    async function formatText() {
      const raw = inputEl.value || '';
      if (!raw) {
          announceStatus('Input empty.');
          return;
      }

      formatSpinner.classList.remove('hidden');
      announceStatus('Processing...');

      await new Promise(r => setTimeout(r, 100));
      
      // Normalize: tabs to spaces, remove all existing line breaks
      let str = raw.replace(/\t/g, '    ');
      str = str.replace(/\r\n/g, '').replace(/\r/g, '').replace(/\n/g, '');
      
      const limit = 66;
      const wordSafetyLimit = 17; // Updated from 11 to 17
      let lines = [];
      let currentLine = "";

      // Split into tokens (words and whitespace)
      const tokens = str.split(/(\s+)/);

      for (let token of tokens) {
          if (token === "") continue;

          // Handle whitespace tokens
          if (token.trim() === "") {
              if (currentLine.length + token.length <= limit) {
                  currentLine += token;
              } else {
                  lines.push(currentLine.trimEnd());
                  currentLine = ""; 
              }
              continue;
          }

          // Handle word tokens
          if (currentLine.length + token.length <= limit) {
              currentLine += token;
          } else {
              // Word exceeds line limit
              if (token.length < wordSafetyLimit) {
                  // Word is short: move the whole thing to the next line
                  if (currentLine.length > 0) lines.push(currentLine.trimEnd());
                  currentLine = token;
              } else {
                  // Word is long (>= 17): split it at the boundary
                  let remainingSpace = limit - currentLine.length;
                  
                  // Fill the rest of the current line
                  if (remainingSpace > 0) {
                      currentLine += token.substring(0, remainingSpace);
                      token = token.substring(remainingSpace);
                  }
                  
                  lines.push(currentLine);
                  
                  // Handle the rest of the long word
                  while (token.length > limit) {
                      lines.push(token.substring(0, limit));
                      token = token.substring(limit);
                  }
                  currentLine = token;
              }
          }
      }

      if (currentLine.trimEnd().length > 0) {
          lines.push(currentLine.trimEnd());
      }
      
      const finalOutput = lines.join('\n');
      outputEl.textContent = finalOutput;
      
      outLinesEl.textContent = lines.length;
      lastLenEl.textContent = lines.length ? lines[lines.length - 1].length : 0;
      
      formatSpinner.classList.add('hidden');
      announceStatus('Formatting complete.');
    }

    formatBtn.addEventListener('click', formatText);

    copyBtn.addEventListener('click', () => {
      const text = outputEl.textContent;
      if (!text) return;

      const textArea = document.createElement("textarea");
      textArea.value = text;
      textArea.style.position = "fixed";
      textArea.style.left = "-9999px";
      textArea.style.top = "0";
      document.body.appendChild(textArea);
      textArea.focus();
      textArea.select();

      try {
        const successful = document.execCommand('copy');
        if (successful) {
          announceStatus('Copied to clipboard.');
        } else {
          announceStatus('Copy failed.');
        }
      } catch (err) {
        announceStatus('Copy error.');
      }

      document.body.removeChild(textArea);
    });
  </script>
</body>
</html>